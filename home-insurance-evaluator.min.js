let currentStep=1;const totalSteps=5;let formData={};function populateYearDropdown(){const e=document.getElementById("yearBuilt");for(let t=(new Date).getFullYear();t>=1900;t--){const a=document.createElement("option");a.value=t,a.textContent=t,e.appendChild(a)}}function setupFormValidation(){document.getElementById("homeEvaluatorForm").querySelectorAll("input, select").forEach(e=>{e.addEventListener("change",function(){this.validity.valid&&this.classList.remove("error")})})}function updateProgressBar(){const e=document.getElementById("progressBar"),t=currentStep/5*100;e.style.width=`${t}%`}function nextStep(){validateCurrentStep()&&(saveStepData(),currentStep++,showStep(currentStep),updateProgressBar())}function previousStep(){currentStep--,showStep(currentStep),updateProgressBar()}function showStep(e){document.querySelectorAll(".form-step").forEach(e=>e.classList.remove("active"));const t=document.querySelector(`[data-step="${e}"]`);t&&t.classList.add("active"),window.scrollTo({top:0,behavior:"smooth"})}function validateCurrentStep(){const e=document.querySelector(".form-step.active").querySelectorAll("[required]");let t=!0;return e.forEach(e=>{e.value?e.classList.remove("error"):(e.classList.add("error"),t=!1)}),t||alert("Please fill in all required fields."),t}function saveStepData(){document.querySelector(".form-step.active").querySelectorAll("input, select").forEach(e=>{"checkbox"===e.type?formData[e.name||e.id]=e.checked:formData[e.name||e.id]=e.value})}function generateReport(){validateCurrentStep()&&(saveStepData(),analyzeData(),showResults())}function analyzeData(){const e=calculateCoverageScore(),t=identifyCoverageGaps(),a=generateRecommendations(),o=identifySavings(),r=calculateReplacementCost(),n=assessRiskProfile(),i=document.getElementById("scoreCircle"),s=document.getElementById("scoreNumber"),l=document.getElementById("scoreMessage");s.textContent=e,i.style.setProperty("--score-deg",e/100*360+"deg"),l.textContent=e>=85?"Excellent coverage! Your home is well protected.":e>=70?"Good coverage with some areas for improvement.":e>=55?"Adequate coverage but significant gaps exist.":"Critical coverage gaps need immediate attention.";document.getElementById("coverageGaps").innerHTML=t.map(e=>`<li>${e}</li>`).join("");document.getElementById("recommendations").innerHTML=a.map(e=>`<li>${e}</li>`).join("");document.getElementById("savingsOpportunities").innerHTML=o.map(e=>`<li>${e}</li>`).join(""),document.getElementById("replacementAnalysis").innerHTML=r,document.getElementById("riskProfile").innerHTML=n}function calculateCoverageScore(){let e=100;const t=(new Date).getFullYear()-parseInt(formData.yearBuilt);t>30&&(e-=5),t>50&&(e-=5),"15-20"===formData.roofAge&&(e-=5),"20+"===formData.roofAge&&(e-=15);const a={"<150k":125e3,"150k-250k":2e5,"250k-350k":3e5,"350k-500k":425e3,"500k-750k":625e3,"750k-1m":875e3,"1m+":125e4}[formData.homeValue]||25e4;({"<100k":75e3,"100k-200k":15e4,"200k-300k":25e4,"300k-400k":35e4,"400k-500k":45e4,"500k-750k":625e3,"750k+":875e3}[formData.dwellingCoverage]||2e5)<.8*(1.2*a)&&(e-=20),"50"===formData.personalProperty&&(e-=10);const o={"<100k":1e5,"100k-250k":3e5,"250k-500k":5e5,"500k-1m":1e6,"1m-2m":1e6,"2m+":1e6}[formData.netWorth]||3e5,r=parseInt(formData.liabilityLimit)||1e5;return r<o&&(e-=15),formData.hasWaterBackup||(e-=10),!formData.hasOrdinanceLaw&&t>20&&(e-=10),formData.hasPool&&r<5e5&&(e-=10),formData.hasTrampoline&&(e-=5),"2"===formData.previousClaims&&(e-=10),"3+"===formData.previousClaims&&(e-=20),formData.hasSecuritySystem&&(e+=5),formData.hasSmokeDetectors&&(e+=3),formData.updatedElectrical&&(e+=3),formData.updatedPlumbing&&(e+=3),Math.max(0,Math.min(100,e))}function identifyCoverageGaps(){const e=[],t=(new Date).getFullYear()-parseInt(formData.yearBuilt);if("not-sure"===formData.dwellingCoverage&&e.push("Unknown dwelling coverage amount - review your policy immediately"),formData.hasWaterBackup||e.push("No water backup coverage - one of the most common and expensive claims"),!formData.hasOrdinanceLaw&&t>20&&e.push("No ordinance/law coverage - critical for older homes that may need upgrades after a loss"),formData.hasFloodInsurance||e.push("No flood insurance - standard policies exclude flood damage"),formData.hasPool&&!e.includes("pool")){(parseInt(formData.liabilityLimit)||1e5)<5e5&&e.push("Pool increases liability risk - current coverage may be insufficient")}formData.hasBusinessUse&&e.push("Home business use may not be covered - consider business insurance"),formData.hasRental&&e.push("Rental activity requires special coverage - standard policies may exclude"),"20+"===formData.roofAge&&e.push("Roof over 20 years old - may face coverage limitations or higher deductibles");return{"<150k":125e3,"150k-250k":2e5,"250k-350k":3e5,"350k-500k":425e3,"500k-750k":625e3,"750k-1m":875e3,"1m+":125e4}[formData.homeValue]>5e5&&"100"!==formData.personalProperty&&e.push("High-value home may need increased personal property coverage"),e.length>0?e:["No critical gaps identified - well done!"]}function generateRecommendations(){const e=[],t=(new Date).getFullYear()-parseInt(formData.yearBuilt);e.push("Review dwelling coverage annually to ensure it keeps pace with construction costs"),"50"!==formData.personalProperty&&"70"!==formData.personalProperty||e.push("Consider increasing personal property coverage to 75-100% of dwelling");return e.push({"<100k":"Maintain at least $300,000 liability coverage","100k-250k":"Increase liability to $300,000-$500,000","250k-500k":"Consider $500,000 liability coverage","500k-1m":"Strongly recommend $1 million liability + umbrella policy","1m-2m":"Essential: $1 million liability + $1-2 million umbrella","2m+":"Critical: Maximum liability + $2-5 million umbrella policy"}[formData.netWorth]||"Review liability limits with your agent"),"500"===formData.deductible&&e.push("Consider raising deductible to $1,000-$2,500 to reduce premiums"),t>15&&e.push("Schedule professional inspections for roof, HVAC, electrical, and plumbing"),formData.hasWaterBackup||e.push("Add water backup coverage - typically costs $30-60/year"),formData.hasIdentityTheft||e.push("Consider identity theft protection - increasingly important coverage"),(formData.hasPool||formData.hasTrampoline)&&e.push("Install security features and maintain strict safety protocols to reduce liability"),e}function identifySavings(){const e=[];e.push("Bundle home with auto insurance for 15-25% discount"),formData.hasSecuritySystem?e.push("Monitored security system discount applied - saving 5-20%"):e.push("Install monitored security system for 5-20% discount"),formData.hasSmokeDetectors&&formData.hasFireExtinguisher&&e.push("Fire safety features qualify for additional discounts"),(formData.updatedElectrical||formData.updatedPlumbing||formData.updatedHVAC)&&e.push("Updated systems may qualify for modernization discounts"),"500"!==formData.deductible&&"1000"!==formData.deductible||e.push("Raising deductible to $2,500 could save 15-30% on premiums");return(new Date).getFullYear()-parseInt(formData.yearBuilt)<10&&e.push("Newer home discount may be available - verify with agent"),"0"===formData.previousClaims&&e.push("Claims-free discount earned - maintain for continued savings"),e.push("Pay annually instead of monthly to save 5-8%"),e.push("Review coverage annually - avoid paying for unnecessary add-ons"),"paid-off"===formData.mortgageBalance&&e.push("No mortgage requirement - flexibility to adjust coverage and save"),e}function calculateReplacementCost(){const e={"<1000":900,"1000-1500":1250,"1500-2000":1750,"2000-2500":2250,"2500-3000":2750,"3000-4000":3500,"4000+":4500}[formData.squareFootage]||2e3,t="single-family"===formData.homeType?150:"townhouse"===formData.homeType?130:"condo"===formData.homeType?110:120,a=e*t;let o="<p><strong>Estimated Replacement Cost:</strong></p>";o+=`<p class="cost-estimate">$${a.toLocaleString()}</p>`,o+=`<p>Based on ${e} sq ft at $${t}/sq ft for ${formData.homeType} in your area.</p>`,o+="<p><strong>Important:</strong> This is a rough estimate. Schedule a professional replacement cost appraisal for accurate coverage needs.</p>";return({"<100k":75e3,"100k-200k":15e4,"200k-300k":25e4,"300k-400k":35e4,"400k-500k":45e4,"500k-750k":625e3,"750k+":875e3}[formData.dwellingCoverage]||2e5)<.8*a&&(o+='<p style="color: #E74C3C;"><strong>Warning:</strong> Your current coverage appears to be less than 80% of replacement cost. This may result in penalties at claim time.</p>'),o}function assessRiskProfile(){let e=0,t='<div class="risk-assessment">';const a=(new Date).getFullYear()-parseInt(formData.yearBuilt);let o,r;return a>30&&(e+=2),a>50&&(e+=3),"15-20"===formData.roofAge&&(e+=2),"20+"===formData.roofAge&&(e+=4),"1"===formData.previousClaims&&(e+=2),"2"===formData.previousClaims&&(e+=4),"3+"===formData.previousClaims&&(e+=6),formData.hasPool&&(e+=3),formData.hasTrampoline&&(e+=2),formData.hasDog&&(e+=1),formData.hasBusinessUse&&(e+=2),formData.hasRental&&(e+=3),formData.hasSecuritySystem&&(e-=1),formData.hasSmokeDetectors&&(e-=1),formData.updatedElectrical&&(e-=1),formData.updatedPlumbing&&(e-=1),e<=3?(o="Low Risk",r="risk-low",t+="<p>Your property presents a favorable risk profile with good insurability.</p>"):e<=8?(o="Moderate Risk",r="risk-medium",t+="<p>Your property has moderate risk factors that may affect premiums.</p>"):(o="High Risk",r="risk-high",t+="<p>Multiple risk factors may lead to higher premiums or coverage restrictions.</p>"),t+=`<p><span class="risk-level ${r}">${o}</span></p>`,t+="<p><strong>Key factors affecting your risk:</strong></p>",t+='<ul style="margin-left: 20px;">',a>30&&(t+="<li>Older home requires more maintenance</li>"),"20+"===formData.roofAge&&(t+="<li>Aging roof increases claim likelihood</li>"),"0"!==formData.previousClaims&&(t+="<li>Previous claims history</li>"),(formData.hasPool||formData.hasTrampoline)&&(t+="<li>Attractive nuisance liability risks</li>"),formData.hasSecuritySystem&&(t+="<li>Security system reduces risk (positive)</li>"),t+="</ul></div>",t}function showResults(){document.getElementById("homeEvaluatorForm").style.display="none",document.getElementById("resultsSection").style.display="block",window.scrollTo({top:0,behavior:"smooth"})}function startOver(){currentStep=1,formData={},document.getElementById("homeEvaluatorForm").reset(),document.getElementById("homeEvaluatorForm").style.display="block",document.getElementById("resultsSection").style.display="none",showStep(1),updateProgressBar()}function downloadReport(){const e=document.getElementById("scoreNumber").textContent,t=Array.from(document.querySelectorAll("#coverageGaps li")).map(e=>e.textContent),a=Array.from(document.querySelectorAll("#recommendations li")).map(e=>e.textContent),o=Array.from(document.querySelectorAll("#savingsOpportunities li")).map(e=>e.textContent),r=document.getElementById("replacementAnalysis").innerText,n=document.getElementById("riskProfile").innerText,i=`\nHOME INSURANCE EVALUATION REPORT\nGenerated: ${(new Date).toLocaleDateString()}\nBill Layne Insurance - (336) 835-1993\n\nCOVERAGE SCORE: ${e}/100\n\nPROPERTY INFORMATION:\n- Type: ${formData.homeType}\n- Year Built: ${formData.yearBuilt}\n- Square Footage: ${formData.squareFootage}\n- Roof Age: ${formData.roofAge}\n\nCOVERAGE GAPS & RISKS:\n${t.map(e=>`• ${e}`).join("\n")}\n\nOUR RECOMMENDATIONS:\n${a.map(e=>`• ${e}`).join("\n")}\n\nPOTENTIAL SAVINGS:\n${o.map(e=>`• ${e}`).join("\n")}\n\nREPLACEMENT COST ANALYSIS:\n${r}\n\nRISK PROFILE:\n${n}\n\nNEXT STEPS:\n1. Call Bill Layne Insurance at (336) 835-1993 for a comprehensive policy review\n2. Gather your current policy documents for comparison\n3. Schedule home inspections if recommended\n4. Implement safety features to reduce risk and save money\n\nThis report is for informational purposes only and does not constitute insurance advice.\nPlease consult with a licensed insurance professional for personalized recommendations.\n    `,s=new Blob([i],{type:"text/plain"}),l=window.URL.createObjectURL(s),m=document.createElement("a");m.href=l,m.download=`home-insurance-evaluation-${(new Date).toISOString().split("T")[0]}.txt`,document.body.appendChild(m),m.click(),document.body.removeChild(m),window.URL.revokeObjectURL(l)}document.addEventListener("DOMContentLoaded",function(){populateYearDropdown(),setupFormValidation(),updateProgressBar()});