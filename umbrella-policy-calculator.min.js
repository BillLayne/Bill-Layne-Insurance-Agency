let currentStep=1;const totalSteps=4;let formData={};function setupFormValidation(){document.getElementById("umbrellaCalculatorForm").querySelectorAll("input, select").forEach(e=>{e.addEventListener("change",function(){this.validity.valid&&this.classList.remove("error")})})}function updateProgressBar(){const e=document.getElementById("progressBar"),t=currentStep/4*100;e.style.width=`${t}%`}function nextStep(){validateCurrentStep()&&(saveStepData(),currentStep++,showStep(currentStep),updateProgressBar())}function previousStep(){currentStep--,showStep(currentStep),updateProgressBar()}function showStep(e){document.querySelectorAll(".form-step").forEach(e=>e.classList.remove("active"));const t=document.querySelector(`[data-step="${e}"]`);t&&t.classList.add("active"),window.scrollTo({top:0,behavior:"smooth"})}function validateCurrentStep(){const e=document.querySelector(".form-step.active").querySelectorAll("[required]");let t=!0;return e.forEach(e=>{e.value?e.classList.remove("error"):(e.classList.add("error"),t=!1)}),t||alert("Please fill in all required fields."),t}function saveStepData(){document.querySelector(".form-step.active").querySelectorAll("input, select").forEach(e=>{"checkbox"===e.type?formData[e.name||e.id]=e.checked:formData[e.name||e.id]=e.value})}function calculateRisk(){validateCurrentStep()&&(saveStepData(),analyzeRisk(),showResults())}function analyzeRisk(){const e=calculateTotalAssets(),t=calculateCurrentCoverage(),a=calculateRiskScore(),n=calculateRecommendedAmount(e,a),o=Math.max(0,e-t);displayRiskMeter(a),displayExposure(e),displayCoverageGap(o,t,e),displayRecommendation(n,e,a),displayRiskFactors(),displayCostEstimate(n,a),displayScenarios()}function calculateTotalAssets(){const e=parseInt(formData.homeValue)||0,t=parseInt(formData.mortgageBalance)||0,a=Math.max(0,e-t),n=parseInt(formData.savingsInvestments)||0,o=parseInt(formData.otherAssets)||0,r=parseInt(formData.annualIncome)||0,s=parseInt(formData.yearsToRetirement)||0;return a+n+o+Math.min(r*s*.3,2e6)}function calculateCurrentCoverage(){const e=parseInt(formData.autoLiability)||0,t=parseInt(formData.homeLiability)||0,a=parseInt(formData.currentUmbrella)||0;return Math.max(e,t)+a}function calculateRiskScore(){let e=0;const t=parseInt(formData.annualIncome)||0;return t>2e5?e+=20:t>15e4?e+=15:t>1e5?e+=10:t>75e3&&(e+=5),"professional"===formData.profession?e+=15:"executive"===formData.profession?e+=10:"business-owner"===formData.profession?e+=20:"public-figure"===formData.profession&&(e+=25),formData.hasPool&&(e+=15),formData.hasTrampoline&&(e+=10),formData.hasDog&&(e+=8),formData.hasTeenDriver&&(e+=20),formData.hasBoat&&(e+=12),formData.hasRental&&(e+=15),formData.hasATV&&(e+=10),formData.entertainFrequently&&(e+=5),formData.volunteerWork&&(e+=8),formData.socialMedia&&(e+=5),formData.longCommute&&(e+=5),formData.homeBusiness&&(e+=10),Math.min(100,e)}function calculateRecommendedAmount(e,t){let a=0;a=e<5e5?1e6:e<1e6?2e6:e<2e6?3e6:e<5e6?5e6:1e7,t>70&&a<5e6?a=Math.min(2*a,5e6):t>50&&a<3e6&&(a=Math.min(1.5*a,3e6));const n=parseInt(formData.currentUmbrella)||0;return Math.max(a-n,0)}function displayRiskMeter(e){const t=document.getElementById("riskMeterFill"),a=document.getElementById("riskLevelText");let n,o;t.style.width=`${e}%`,e<25?(n="Low Risk",o="Your liability risk is relatively low, but umbrella coverage is still recommended for asset protection."):e<50?(n="Moderate Risk",o="You have moderate liability exposure. Umbrella coverage is strongly recommended."):e<75?(n="High Risk",o="Your liability risk is high. Umbrella coverage is essential for protecting your assets."):(n="Critical Risk",o="You have critical liability exposure. Substantial umbrella coverage is urgently needed."),a.innerHTML=`<strong>${n}</strong><br>${o}`}function displayExposure(e){const t=document.getElementById("exposureAmount"),a=document.getElementById("exposureBreakdown");t.textContent=`$${e.toLocaleString()}`;const n=parseInt(formData.homeValue)||0,o=parseInt(formData.mortgageBalance)||0,r=Math.max(0,n-o),s=parseInt(formData.savingsInvestments)||0,i=parseInt(formData.otherAssets)||0,l=parseInt(formData.annualIncome)||0,c=parseInt(formData.yearsToRetirement)||0,m=Math.min(l*c*.3,2e6);let u="<strong>Asset Breakdown:</strong><br>";r>0&&(u+=`• Home Equity: $${r.toLocaleString()}<br>`),s>0&&(u+=`• Savings & Investments: $${s.toLocaleString()}<br>`),i>0&&(u+=`• Other Assets: $${i.toLocaleString()}<br>`),m>0&&(u+=`• Future Earnings Potential: $${m.toLocaleString()}<br>`),a.innerHTML=u}function displayCoverageGap(e,t,a){const n=document.getElementById("gapAmount"),o=document.getElementById("gapDescription"),r=document.getElementById("coverageVisual");e>0?(n.textContent=`$${e.toLocaleString()}`,n.style.color="#E74C3C",o.textContent="Your assets exceed your current liability coverage"):(n.textContent="No Gap",n.style.color="#27AE60",o.textContent="Your current coverage exceeds your total assets");const s=Math.min(100,t/a*100);r.innerHTML=`\n        <div style="background: #E0E6ED; height: 30px; border-radius: 15px; overflow: hidden;">\n            <div style="background: ${e>0?"#E74C3C":"#27AE60"}; width: ${s}%; height: 100%; transition: width 1s ease;"></div>\n        </div>\n        <p style="margin-top: 0.5rem; color: #5D6D7E;">Current coverage: ${s.toFixed(0)}% of total assets</p>\n    `}function displayRecommendation(e,t,a){const n=document.getElementById("recommendedAmount"),o=document.getElementById("recommendationText"),r=document.getElementById("recommendationReasons"),s=e+(parseInt(formData.currentUmbrella)||0);0===e&&"0"!==formData.currentUmbrella?(n.textContent="Current Coverage Adequate",n.style.color="#27AE60",o.textContent="Your current umbrella policy appears sufficient for your needs."):(n.textContent=`$${s.toLocaleString()}`,o.textContent=e>0?"Additional umbrella coverage recommended":"Umbrella policy strongly recommended");const i=[];t>5e5&&i.push(`Your total assets of $${t.toLocaleString()} require substantial protection`),a>50&&i.push("Your high-risk factors increase liability exposure"),formData.hasTeenDriver&&i.push("Teen drivers significantly increase accident risk"),(formData.hasPool||formData.hasTrampoline)&&i.push("Attractive nuisances on property increase liability"),parseInt(formData.annualIncome)>15e4&&i.push("High income makes you a target for larger lawsuits"),"professional"!==formData.profession&&"executive"!==formData.profession||i.push("Your professional status increases lawsuit risk"),r.innerHTML=i.map(e=>`<li>${e}</li>`).join("")}function displayRiskFactors(){const e=document.getElementById("factorsList"),t=[];formData.hasTeenDriver&&t.push({name:"Teen Driver",impact:"high"}),formData.hasPool&&t.push({name:"Swimming Pool",impact:"high"}),formData.hasRental&&t.push({name:"Rental Property",impact:"high"}),"business-owner"===formData.profession&&t.push({name:"Business Owner",impact:"high"}),formData.hasBoat&&t.push({name:"Boat Owner",impact:"medium"}),formData.hasTrampoline&&t.push({name:"Trampoline",impact:"medium"}),formData.hasATV&&t.push({name:"ATV/Motorcycle",impact:"medium"}),formData.homeBusiness&&t.push({name:"Home Business",impact:"medium"}),formData.hasDog&&t.push({name:"Dog Owner",impact:"low"}),formData.entertainFrequently&&t.push({name:"Frequent Entertaining",impact:"low"}),formData.volunteerWork&&t.push({name:"Volunteer Work",impact:"low"}),formData.socialMedia&&t.push({name:"Social Media Activity",impact:"low"}),0===t.length&&t.push({name:"No significant risk factors identified",impact:"low"}),e.innerHTML=t.map(e=>`\n        <div class="factor-item">\n            <span class="factor-name">${e.name}</span>\n            <span class="factor-impact impact-${e.impact}">${e.impact.charAt(0).toUpperCase()+e.impact.slice(1)} Risk</span>\n        </div>\n    `).join("")}function displayCostEstimate(e,t){const a=document.getElementById("costRange"),n=e+(parseInt(formData.currentUmbrella)||0);let o=0;o=n<=1e6?200:n<=2e6?375:n<=3e6?525:n<=5e6?800:1200;const r=1+t/100*.5,s=Math.round(.8*o*r),i=Math.round(1.3*o*r);a.textContent=`$${s} - $${i}`}function displayScenarios(){const e=document.getElementById("scenariosGrid"),t=[];formData.hasTeenDriver&&t.push({title:"Teen Driver Accident",description:"Your teen causes a serious accident with multiple injuries. Medical bills and lawsuits exceed $2 million."}),formData.hasPool&&t.push({title:"Pool Accident",description:"A guest is seriously injured diving into your pool. Lifetime medical care costs exceed $1.5 million."}),formData.hasDog&&t.push({title:"Dog Bite Incident",description:"Your dog bites a neighbor's child requiring surgery. Medical bills and lawsuit total $500,000."}),t.push({title:"Auto Accident",description:"You cause a multi-vehicle accident. Several people are injured with damages exceeding $1 million."}),t.push({title:"Defamation Lawsuit",description:"A social media post leads to a defamation lawsuit. Legal defense and damages total $750,000."}),(formData.entertainFrequently||t.length<3)&&t.push({title:"Guest Injury",description:"A guest falls at your home and suffers permanent injury. Lawsuit awards $800,000 in damages."}),e.innerHTML=t.slice(0,4).map(e=>`\n        <div class="scenario-item">\n            <div class="scenario-title">${e.title}</div>\n            <div class="scenario-description">${e.description}</div>\n        </div>\n    `).join("")}function showResults(){document.getElementById("umbrellaCalculatorForm").style.display="none",document.getElementById("resultsSection").style.display="block",window.scrollTo({top:0,behavior:"smooth"})}function startOver(){currentStep=1,formData={},document.getElementById("umbrellaCalculatorForm").reset(),document.getElementById("umbrellaCalculatorForm").style.display="block",document.getElementById("resultsSection").style.display="none",showStep(1),updateProgressBar()}function downloadReport(){const e=calculateTotalAssets(),t=calculateCurrentCoverage(),a=calculateRiskScore(),n=calculateRecommendedAmount(e,a)+(parseInt(formData.currentUmbrella)||0),o=`\nUMBRELLA POLICY ANALYSIS REPORT\nGenerated: ${(new Date).toLocaleDateString()}\nBill Layne Insurance - (336) 835-1993\n\nEXECUTIVE SUMMARY\nTotal Assets at Risk: $${e.toLocaleString()}\nCurrent Total Coverage: $${t.toLocaleString()}\nCoverage Gap: $${Math.max(0,e-t).toLocaleString()}\nRisk Score: ${a}/100\nRecommended Umbrella Coverage: $${n.toLocaleString()}\n\nASSET BREAKDOWN\n- Home Equity: $${Math.max(0,parseInt(formData.homeValue)-parseInt(formData.mortgageBalance)).toLocaleString()}\n- Savings & Investments: $${parseInt(formData.savingsInvestments).toLocaleString()}\n- Other Assets: $${parseInt(formData.otherAssets).toLocaleString()}\n- Future Earnings Potential: Included in analysis\n\nCURRENT COVERAGE\n- Auto Liability: $${parseInt(formData.autoLiability).toLocaleString()}\n- Home Liability: $${parseInt(formData.homeLiability).toLocaleString()}\n- Current Umbrella: $${parseInt(formData.currentUmbrella).toLocaleString()}\n\nRISK FACTORS IDENTIFIED\n${formData.hasTeenDriver?"• Teen driver in household\n":""}${formData.hasPool?"• Swimming pool on property\n":""}${formData.hasTrampoline?"• Trampoline on property\n":""}${formData.hasDog?"• Dog ownership\n":""}${formData.hasBoat?"• Boat ownership\n":""}${formData.hasRental?"• Rental property ownership\n":""}${formData.hasATV?"• ATV/Motorcycle ownership\n":""}${formData.homeBusiness?"• Home-based business\n":""}${formData.entertainFrequently?"• Frequent entertaining\n":""}${formData.volunteerWork?"• Volunteer work exposure\n":""}\n\nRECOMMENDATION\nBased on your total assets of $${e.toLocaleString()} and risk profile, we recommend \numbrella coverage of $${n.toLocaleString()}. This will provide adequate protection \nfor your assets and future earnings in the event of a catastrophic lawsuit.\n\nESTIMATED ANNUAL COST\n$${Math.round(n/1e6*375)} - $${Math.round(n/1e6*650)}\n*Actual cost depends on specific circumstances and carrier\n\nNEXT STEPS\n1. Call Bill Layne Insurance at (336) 835-1993 for a personalized quote\n2. Review your auto and home policies to ensure adequate underlying limits\n3. Consider increasing base liability limits if currently at state minimums\n4. Implement risk reduction strategies for identified exposures\n\nWHY UMBRELLA COVERAGE IS IMPORTANT\n- Protects assets beyond auto/home policy limits\n- Covers legal defense costs\n- Provides worldwide coverage\n- Protects future earnings\n- Covers many situations not included in other policies\n\nThis analysis is for informational purposes only and does not constitute insurance advice.\nPlease consult with a licensed insurance professional for personalized recommendations.\n    `,r=new Blob([o],{type:"text/plain"}),s=window.URL.createObjectURL(r),i=document.createElement("a");i.href=s,i.download=`umbrella-policy-analysis-${(new Date).toISOString().split("T")[0]}.txt`,document.body.appendChild(i),i.click(),document.body.removeChild(i),window.URL.revokeObjectURL(s)}document.addEventListener("DOMContentLoaded",function(){setupFormValidation(),updateProgressBar()});