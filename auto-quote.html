<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Get Auto Insurance Quote - Bill Layne Insurance</title>
    
    <!-- Cache Control for HTML (reasonable caching) -->
    <meta http-equiv="Cache-Control" content="max-age=3600, must-revalidate">
    
    <!-- Version Definition -->
    <script>
        // SITE VERSION - Update this when making changes
        window.SITE_VERSION = '2025.01.17.1';
        
        // GOOGLE APPS SCRIPT URL - Your deployed script URL
        const SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbxNV0Zdwz-6fRerTmVhMdmdi9RfF8pj2tJvrg6fznjYQizZo8YopAlFtDbfbcKo2pFx/exec';
        
        // Check if in development mode
        const isDevelopment = window.location.hostname === 'localhost' || 
                             window.location.hostname === '127.0.0.1' ||
                             window.location.search.includes('dev=true');
        
        // Auto-versioning for development only
        if (isDevelopment) {
            window.SITE_VERSION = Date.now();
            console.log('Development mode: Cache disabled');
        }
    </script>
    
    <!-- Resource Hints for Performance -->
    <!-- DNS Prefetch for external resources -->
    <link rel="dns-prefetch" href="//fonts.googleapis.com">
    <link rel="dns-prefetch" href="//cdn.tailwindcss.com">
    <link rel="dns-prefetch" href="//cdnjs.cloudflare.com">
    
    <!-- Preload critical resources -->
    <link rel="preload" href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700;800&display=swap" as="style">
    
    <!-- Tailwind CSS for modern styling -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Preconnect for critical resources -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700;800&display=swap" rel="stylesheet">
    
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">

    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
        
        .progress-fill {
            transition: width 0.5s ease;
        }
        
        .form-step {
            display: none;
            animation: fadeIn 0.5s ease;
        }
        
        .form-step.active {
            display: block;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .driver-entry, .vehicle-entry {
            background: #f9f9f9;
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            padding: 1rem;
            margin-bottom: 1rem;
            position: relative;
        }
        
        .remove-btn {
            position: absolute;
            top: 0.5rem;
            right: 0.5rem;
            background: #ef4444;
            color: white;
            border: none;
            border-radius: 50%;
            width: 24px;
            height: 24px;
            cursor: pointer;
            font-size: 0.875rem;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        /* Loading overlay */
        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.7);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 9999;
        }
        
        .loading-overlay.active {
            display: flex;
        }
        
        .loading-content {
            background: white;
            padding: 2rem;
            border-radius: 8px;
            text-align: center;
        }
        
        .spinner {
            border: 3px solid #f3f3f3;
            border-top: 3px solid #003366;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto 1rem;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        /* Success Modal Popup */
        .success-modal {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.8);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 10000;
            animation: fadeIn 0.3s ease;
        }
        
        .success-modal.active {
            display: flex !important;
        }
        
        .success-modal-content {
            background: white;
            padding: 3rem;
            border-radius: 12px;
            text-align: center;
            max-width: 500px;
            width: 90%;
            position: relative;
            animation: slideUp 0.5s ease;
        }
        
        @keyframes slideUp {
            from {
                opacity: 0;
                transform: translateY(50px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .success-checkmark {
            width: 80px;
            height: 80px;
            margin: 0 auto 1.5rem;
            position: relative;
        }
        
        .checkmark-circle {
            stroke-dasharray: 166;
            stroke-dashoffset: 166;
            stroke-width: 2;
            stroke-miterlimit: 10;
            stroke: #28a745;
            fill: none;
            animation: stroke 0.6s cubic-bezier(0.65, 0, 0.45, 1) forwards;
        }
        
        .checkmark {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            display: block;
            stroke-width: 2;
            stroke: #fff;
            stroke-miterlimit: 10;
            box-shadow: inset 0px 0px 0px #28a745;
            animation: fill .4s ease-in-out .4s forwards, scale .3s ease-in-out .9s both;
        }
        
        .checkmark-check {
            transform-origin: 50% 50%;
            stroke-dasharray: 48;
            stroke-dashoffset: 48;
            animation: stroke 0.3s cubic-bezier(0.65, 0, 0.45, 1) 0.8s forwards;
        }
        
        @keyframes stroke {
            100% {
                stroke-dashoffset: 0;
            }
        }
        
        @keyframes scale {
            0%, 100% {
                transform: none;
            }
            50% {
                transform: scale3d(1.1, 1.1, 1);
            }
        }
        
        @keyframes fill {
            100% {
                box-shadow: inset 0px 0px 0px 40px #28a745;
            }
        }
        
        .confirmation-number-box {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 1rem;
            border-radius: 8px;
            margin: 1.5rem 0;
            font-size: 1.25rem;
            font-weight: bold;
            letter-spacing: 1px;
        }
    </style>
</head>
<body class="bg-gray-50">
    <!-- Loading Overlay -->
    <div id="loadingOverlay" class="loading-overlay">
        <div class="loading-content">
            <div class="spinner"></div>
            <p class="text-lg font-semibold">Submitting your quote request...</p>
            <p class="text-sm text-gray-600 mt-2">Please don't close this window</p>
        </div>
    </div>

    <!-- Success Confirmation Modal -->
    <div id="successModal" class="success-modal">
        <div class="success-modal-content">
            <div class="success-checkmark">
                <svg class="checkmark" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 52 52">
                    <circle class="checkmark-circle" cx="26" cy="26" r="25" fill="none"/>
                    <path class="checkmark-check" fill="none" d="M14.1 27.2l7.1 7.2 16.7-16.8"/>
                </svg>
            </div>
            
            <h2 class="text-3xl font-bold text-gray-800 mb-3">Thank You for Reaching Out!</h2>
            <p class="text-lg text-gray-600 mb-4">Your auto insurance quote request has been successfully submitted!</p>
            
            <div class="bg-green-50 border border-green-200 rounded-lg p-4 mb-4">
                <p class="text-gray-700">
                    <i class="fas fa-shopping-cart text-green-600 mr-2"></i>
                    <strong>We're now shopping your coverage with ALL our carriers!</strong><br>
                    <span class="text-sm">Our team will compare rates from multiple insurance companies to find you the best coverage at the most competitive price.</span>
                </p>
            </div>
            
            <div class="confirmation-number-box">
                <p class="text-sm opacity-90 mb-1">Your Confirmation Number</p>
                <p class="text-2xl" id="modal-confirmation-number">AUTO-20250117-0001</p>
            </div>
            
            <div class="bg-blue-50 border-l-4 border-blue-400 p-4 mb-6 text-left">
                <p class="text-sm text-gray-700">
                    <i class="fas fa-clock text-blue-500 mr-2"></i>
                    <strong>What happens next?</strong><br>
                    • We're immediately shopping your coverage with Nationwide, Progressive, Travelers, and more!<br>
                    • Our specialists will compare rates from multiple carriers<br>
                    • You'll receive personalized quotes within 24 hours<br>
                    • We'll contact you shortly via email or phone
                </p>
            </div>
            
            <div class="grid grid-cols-2 gap-4 mb-4">
                <div class="text-center">
                    <i class="fas fa-phone-alt text-blue-500 text-2xl mb-2"></i>
                    <p class="text-sm text-gray-600">Questions?</p>
                    <p class="font-semibold">336-835-1993</p>
                </div>
                <div class="text-center">
                    <i class="fas fa-envelope text-blue-500 text-2xl mb-2"></i>
                    <p class="text-sm text-gray-600">Email Us</p>
                    <p class="font-semibold">Save@BillLayneInsurance.com</p>
                </div>
            </div>
            
            <p class="text-sm text-gray-500 mb-6">
                A confirmation email has been sent to <span id="customer-email" class="font-semibold"></span>
            </p>
            
            <div class="flex gap-3 justify-center">
                <button onclick="closeSuccessModal()" class="px-6 py-2 bg-gray-200 text-gray-700 rounded-md hover:bg-gray-300 transition">
                    Close
                </button>
                <a href="index.html" class="px-6 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 transition inline-block">
                    Return to Home
                </a>
            </div>
        </div>
    </div>

    <!-- Simple Header -->
    <header class="bg-white shadow-sm">
        <div class="container mx-auto px-6 py-4">
            <div class="flex justify-between items-center">
                <a href="index.html" class="text-2xl font-bold text-gray-800">Bill Layne Insurance</a>
                <a href="index.html" class="text-gray-600 hover:text-gray-800">
                    <i class="fas fa-times text-xl"></i>
                </a>
            </div>
        </div>
    </header>

    <!-- Main Form Container -->
    <main class="py-8">
        <div class="container mx-auto px-6 max-w-2xl">
            <div class="bg-white rounded-lg shadow-lg p-8">
                <!-- Progress Bar -->
                <div class="mb-8">
                    <div class="flex justify-between text-sm text-gray-600 mb-2">
                        <span>Step <span id="current-step">1</span> of 6</span>
                        <span><span id="progress-percent">17</span>% Complete</span>
                    </div>
                    <div class="w-full bg-gray-200 rounded-full h-2">
                        <div id="progress-bar" class="bg-blue-600 h-2 rounded-full progress-fill" style="width: 17%"></div>
                    </div>
                </div>

                <form id="auto-quote-form">
                    <!-- Step 1: Personal Information -->
                    <div class="form-step active" data-step="1">
                        <h2 class="text-2xl font-bold mb-2">Let's get to know you</h2>
                        <p class="text-gray-600 mb-6">We'll start with some basic information to personalize your quote.</p>
                        
                        <div class="space-y-4">
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-1">First Name*</label>
                                    <input type="text" name="firstname" required class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-1">Last Name*</label>
                                    <input type="text" name="lastname" required class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                                </div>
                            </div>
                            
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Email Address*</label>
                                <input type="email" name="email" required class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                            </div>
                            
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Phone Number*</label>
                                <input type="tel" name="phone" required class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                            </div>

                            <!-- Hidden field - default contact method to email -->
                            <input type="hidden" name="contact_method" value="email">
                        </div>
                    </div>

                    <!-- Step 2: Drivers -->
                    <div class="form-step" data-step="2">
                        <h2 class="text-2xl font-bold mb-2">Who will be driving?</h2>
                        <p class="text-gray-600 mb-6">Tell us about everyone who will be on the policy.</p>
                        
                        <div id="drivers-container">
                            <div class="driver-entry" data-driver="1">
                                <h3 class="font-semibold mb-3">Primary Driver</h3>
                                <div class="space-y-4">
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-1">Full Name*</label>
                                        <input type="text" name="driver_1_name" required class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                                    </div>
                                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                        <div>
                                            <label class="block text-sm font-medium text-gray-700 mb-1">Date of Birth*</label>
                                            <input type="date" name="driver_1_dob" required class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                                        </div>
                                        <div>
                                            <label class="block text-sm font-medium text-gray-700 mb-1">Gender</label>
                                            <select name="driver_1_gender" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                                                <option value="">Select</option>
                                                <option value="male">Male</option>
                                                <option value="female">Female</option>
                                            </select>
                                        </div>
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-1">Marital Status</label>
                                        <select name="driver_1_marital" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                                            <option value="">Select</option>
                                            <option value="single">Single</option>
                                            <option value="married">Married</option>
                                            <option value="divorced">Divorced</option>
                                            <option value="widowed">Widowed</option>
                                        </select>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <button type="button" onclick="addDriver()" class="mt-4 w-full py-2 px-4 border-2 border-dashed border-blue-500 text-blue-500 rounded-md hover:bg-blue-50 transition">
                            <i class="fas fa-plus mr-2"></i>Add Another Driver
                        </button>
                    </div>

                    <!-- Step 3: Current Insurance -->
                    <div class="form-step" data-step="3">
                        <h2 class="text-2xl font-bold mb-2">Current Insurance Status</h2>
                        <p class="text-gray-600 mb-6">This helps us find you the best rates.</p>
                        
                        <div class="space-y-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Do you currently have auto insurance?</label>
                                <select name="current_insurance" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                                    <option value="yes">Yes</option>
                                    <option value="no">No</option>
                                </select>
                            </div>
                            
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Current Insurance Company (if applicable)</label>
                                <input type="text" name="current_carrier" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                            </div>
                            
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Coverage Expiration Date</label>
                                <input type="date" name="coverage_expiration" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                            </div>
                        </div>
                    </div>

                    <!-- Step 4: Vehicles -->
                    <div class="form-step" data-step="4">
                        <h2 class="text-2xl font-bold mb-2">Tell us about your vehicles</h2>
                        <p class="text-gray-600 mb-6">We'll need details for each vehicle you want to insure.</p>
                        
                        <div id="vehicles-container">
                            <div class="vehicle-entry" data-vehicle="1">
                                <h3 class="font-semibold mb-3">Vehicle 1</h3>
                                <div class="space-y-4">
                                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                                        <div>
                                            <label class="block text-sm font-medium text-gray-700 mb-1">Year*</label>
                                            <input type="number" name="vehicle_1_year" required min="1900" max="2025" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                                        </div>
                                        <div>
                                            <label class="block text-sm font-medium text-gray-700 mb-1">Make*</label>
                                            <input type="text" name="vehicle_1_make" required class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                                        </div>
                                        <div>
                                            <label class="block text-sm font-medium text-gray-700 mb-1">Model*</label>
                                            <input type="text" name="vehicle_1_model" required class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                                        </div>
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-1">VIN (Optional)</label>
                                        <input type="text" name="vehicle_1_vin" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <button type="button" onclick="addVehicle()" class="mt-4 w-full py-2 px-4 border-2 border-dashed border-blue-500 text-blue-500 rounded-md hover:bg-blue-50 transition">
                            <i class="fas fa-plus mr-2"></i>Add Another Vehicle
                        </button>
                    </div>

                    <!-- Step 5: Coverage Preferences -->
                    <div class="form-step" data-step="5">
                        <h2 class="text-2xl font-bold mb-2">Coverage Preferences</h2>
                        <p class="text-gray-600 mb-6">Select the types of coverage you're interested in.</p>
                        
                        <div class="space-y-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Liability Limits</label>
                                <select name="liability_limits" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                                    <option value="">Select preferred limits</option>
                                    <option value="state_minimum">State Minimum</option>
                                    <option value="50/100/50">50/100/50</option>
                                    <option value="100/300/100">100/300/100</option>
                                    <option value="250/500/250">250/500/250</option>
                                </select>
                            </div>
                            
                            <div class="space-y-2">
                                <label class="flex items-center">
                                    <input type="checkbox" name="collision" class="mr-2">
                                    <span class="text-sm">Collision Coverage</span>
                                </label>
                                <label class="flex items-center">
                                    <input type="checkbox" name="comprehensive" class="mr-2">
                                    <span class="text-sm">Comprehensive Coverage</span>
                                </label>
                                <label class="flex items-center">
                                    <input type="checkbox" name="uninsured_motorist" class="mr-2">
                                    <span class="text-sm">Uninsured/Underinsured Motorist</span>
                                </label>
                                <label class="flex items-center">
                                    <input type="checkbox" name="medical_payments" class="mr-2">
                                    <span class="text-sm">Medical Payments</span>
                                </label>
                                <label class="flex items-center">
                                    <input type="checkbox" name="rental_reimbursement" class="mr-2">
                                    <span class="text-sm">Rental Reimbursement</span>
                                </label>
                                <label class="flex items-center">
                                    <input type="checkbox" name="roadside_assistance" class="mr-2">
                                    <span class="text-sm">Roadside Assistance</span>
                                </label>
                            </div>
                        </div>
                    </div>

                    <!-- Step 6: Additional Information -->
                    <div class="form-step" data-step="6">
                        <h2 class="text-2xl font-bold mb-2">Almost done!</h2>
                        <p class="text-gray-600 mb-6">Any additional information that might help us get you the best rate?</p>
                        
                        <div class="space-y-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Have you had any claims in the past 5 years?</label>
                                <select name="previous_claims" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                                    <option value="no">No</option>
                                    <option value="yes">Yes</option>
                                </select>
                            </div>
                            
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Any moving violations in the past 3 years?</label>
                                <select name="violations" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                                    <option value="no">No</option>
                                    <option value="yes">Yes</option>
                                </select>
                            </div>
                            
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Additional Notes (Optional)</label>
                                <textarea name="additional_notes" rows="4" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"></textarea>
                            </div>
                        </div>
                    </div>

                    <!-- Navigation Buttons -->
                    <div class="flex justify-between mt-8">
                        <button type="button" id="prev-btn" onclick="previousStep()" class="px-6 py-2 bg-gray-200 text-gray-700 rounded-md hover:bg-gray-300 transition" style="display: none;">
                            <i class="fas fa-arrow-left mr-2"></i>Previous
                        </button>
                        <button type="button" id="next-btn" onclick="nextStep()" class="ml-auto px-6 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 transition">
                            Next<i class="fas fa-arrow-right ml-2"></i>
                        </button>
                        <button type="submit" id="submit-btn" class="ml-auto px-6 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 transition" style="display: none;">
                            Submit Quote Request<i class="fas fa-paper-plane ml-2"></i>
                        </button>
                    </div>
                </form>

                <!-- Success Message (Hidden - Using Modal Instead) -->
                <div id="success-message" class="text-center py-12" style="display: none;">
                    <i class="fas fa-check-circle text-green-500 text-6xl mb-4"></i>
                    <h2 class="text-2xl font-bold mb-2">Thank You!</h2>
                    <p class="text-gray-600 mb-4">We've received your quote request and will contact you within 24 hours with your personalized rates.</p>
                    <div class="bg-blue-50 border border-blue-200 rounded-lg p-4 mb-6">
                        <p class="text-sm text-gray-600">Your confirmation number:</p>
                        <p class="text-2xl font-bold text-blue-600" id="confirmation-number">Loading...</p>
                    </div>
                    <a href="index.html" class="inline-block px-6 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 transition">
                        Return to Home
                    </a>
                </div>
            </div>
        </div>
    </main>

    <script>
        let currentStep = 1;
        const totalSteps = 6;
        let driverCount = 1;
        let vehicleCount = 1;

        function updateProgress() {
            const percent = Math.round((currentStep / totalSteps) * 100);
            document.getElementById('current-step').textContent = currentStep;
            document.getElementById('progress-percent').textContent = percent;
            document.getElementById('progress-bar').style.width = percent + '%';
        }

        function showStep(step) {
            document.querySelectorAll('.form-step').forEach(el => {
                el.classList.remove('active');
            });
            document.querySelector(`[data-step="${step}"]`).classList.add('active');
            
            // Update navigation buttons
            document.getElementById('prev-btn').style.display = step === 1 ? 'none' : 'block';
            document.getElementById('next-btn').style.display = step === totalSteps ? 'none' : 'block';
            document.getElementById('submit-btn').style.display = step === totalSteps ? 'block' : 'none';
            
            updateProgress();
        }

        function nextStep() {
            if (validateStep(currentStep)) {
                if (currentStep < totalSteps) {
                    currentStep++;
                    showStep(currentStep);
                }
            }
        }

        function previousStep() {
            if (currentStep > 1) {
                currentStep--;
                showStep(currentStep);
            }
        }

        function validateStep(step) {
            const activeStep = document.querySelector(`[data-step="${step}"]`);
            const requiredFields = activeStep.querySelectorAll('[required]');
            let isValid = true;
            
            requiredFields.forEach(field => {
                if (!field.value.trim()) {
                    field.classList.add('border-red-500');
                    isValid = false;
                } else {
                    field.classList.remove('border-red-500');
                }
            });
            
            if (!isValid) {
                alert('Please fill in all required fields.');
            }
            
            return isValid;
        }

        function addDriver() {
            driverCount++;
            const driverHtml = `
                <div class="driver-entry" data-driver="${driverCount}">
                    <button type="button" onclick="removeEntry(this)" class="remove-btn">×</button>
                    <h3 class="font-semibold mb-3">Additional Driver ${driverCount}</h3>
                    <div class="space-y-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Full Name*</label>
                            <input type="text" name="driver_${driverCount}_name" required class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                        </div>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Date of Birth*</label>
                                <input type="date" name="driver_${driverCount}_dob" required class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Gender</label>
                                <select name="driver_${driverCount}_gender" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                                    <option value="">Select</option>
                                    <option value="male">Male</option>
                                    <option value="female">Female</option>
                                </select>
                            </div>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Marital Status</label>
                            <select name="driver_${driverCount}_marital" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                                <option value="">Select</option>
                                <option value="single">Single</option>
                                <option value="married">Married</option>
                                <option value="divorced">Divorced</option>
                                <option value="widowed">Widowed</option>
                            </select>
                        </div>
                    </div>
                </div>
            `;
            document.getElementById('drivers-container').insertAdjacentHTML('beforeend', driverHtml);
        }

        function addVehicle() {
            vehicleCount++;
            const vehicleHtml = `
                <div class="vehicle-entry" data-vehicle="${vehicleCount}">
                    <button type="button" onclick="removeEntry(this)" class="remove-btn">×</button>
                    <h3 class="font-semibold mb-3">Vehicle ${vehicleCount}</h3>
                    <div class="space-y-4">
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Year*</label>
                                <input type="number" name="vehicle_${vehicleCount}_year" required min="1900" max="2025" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Make*</label>
                                <input type="text" name="vehicle_${vehicleCount}_make" required class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Model*</label>
                                <input type="text" name="vehicle_${vehicleCount}_model" required class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                            </div>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">VIN (Optional)</label>
                            <input type="text" name="vehicle_${vehicleCount}_vin" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                        </div>
                    </div>
                </div>
            `;
            document.getElementById('vehicles-container').insertAdjacentHTML('beforeend', vehicleHtml);
        }

        function removeEntry(button) {
            button.closest('.driver-entry, .vehicle-entry').remove();
        }
        
        // Close success modal
        function closeSuccessModal() {
            const modal = document.getElementById('successModal');
            if (modal) {
                modal.classList.remove('active');
                modal.style.display = 'none';
                
                // Reset form after closing modal
                document.getElementById('auto-quote-form').reset();
                currentStep = 1;
                showStep(1);
                driverCount = 1;
                vehicleCount = 1;
                
                // Clear any extra driver/vehicle entries
                document.querySelectorAll('.driver-entry[data-driver]:not([data-driver="1"])').forEach(el => el.remove());
                document.querySelectorAll('.vehicle-entry[data-vehicle]:not([data-vehicle="1"])').forEach(el => el.remove());
            }
        }
        
        // Test function to show modal (for debugging)
        function testSuccessModal() {
            const modal = document.getElementById('successModal');
            if (modal) {
                document.getElementById('modal-confirmation-number').textContent = 'AUTO-TEST-0001';
                document.getElementById('customer-email').textContent = 'test@example.com';
                modal.style.display = 'flex';
                modal.classList.add('active');
                console.log('Test modal shown');
            } else {
                console.error('Modal not found!');
            }
        }
        
        // Close modal with Escape key
        document.addEventListener('keydown', function(e) {
            if (e.key === 'Escape') {
                closeSuccessModal();
            }
        });
        
        // Close modal when clicking outside
        document.getElementById('successModal').addEventListener('click', function(e) {
            if (e.target === this) {
                closeSuccessModal();
            }
        });

        // Get metadata
        function getMetadata() {
            return {
                ip: 'Will be captured server-side',
                userAgent: navigator.userAgent,
                platform: navigator.platform,
                language: navigator.language,
                screenResolution: `${screen.width}x${screen.height}`,
                timezone: Intl.DateTimeFormat().resolvedOptions().timeZone,
                timestamp: new Date().toISOString()
            };
        }

        // Handle form submission with Google Apps Script
        document.getElementById('auto-quote-form').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            if (!validateStep(currentStep)) {
                return;
            }
            
            const submitBtn = document.getElementById('submit-btn');
            const loadingOverlay = document.getElementById('loadingOverlay');
            
            // Show loading state
            submitBtn.disabled = true;
            submitBtn.innerHTML = 'Submitting... <i class="fas fa-spinner fa-spin ml-2"></i>';
            loadingOverlay.classList.add('active');
            
            const formData = new FormData(e.target);
            
            // Collect drivers data
            const drivers = [];
            for (let i = 1; i <= driverCount; i++) {
                const driverName = formData.get(`driver_${i}_name`);
                if (driverName) {
                    drivers.push({
                        name: driverName,
                        dob: formData.get(`driver_${i}_dob`) || '',
                        gender: formData.get(`driver_${i}_gender`) || '',
                        marital: formData.get(`driver_${i}_marital`) || ''
                    });
                }
            }
            
            // Collect vehicles data
            const vehicles = [];
            for (let i = 1; i <= vehicleCount; i++) {
                const vehicleYear = formData.get(`vehicle_${i}_year`);
                if (vehicleYear) {
                    vehicles.push({
                        year: vehicleYear,
                        make: formData.get(`vehicle_${i}_make`) || '',
                        model: formData.get(`vehicle_${i}_model`) || '',
                        vin: formData.get(`vehicle_${i}_vin`) || ''
                    });
                }
            }
            
            // Prepare data for Google Apps Script
            const data = {
                firstname: formData.get('firstname'),
                lastname: formData.get('lastname'),
                email: formData.get('email'),
                phone: formData.get('phone'),
                contact_method: formData.get('contact_method'),
                current_insurance: formData.get('current_insurance'),
                current_carrier: formData.get('current_carrier'),
                coverage_expiration: formData.get('coverage_expiration'),
                liability_limits: formData.get('liability_limits'),
                collision: formData.get('collision') ? true : false,
                comprehensive: formData.get('comprehensive') ? true : false,
                uninsured_motorist: formData.get('uninsured_motorist') ? true : false,
                medical_payments: formData.get('medical_payments') ? true : false,
                rental_reimbursement: formData.get('rental_reimbursement') ? true : false,
                roadside_assistance: formData.get('roadside_assistance') ? true : false,
                previous_claims: formData.get('previous_claims'),
                violations: formData.get('violations'),
                additional_notes: formData.get('additional_notes'),
                drivers: drivers,
                vehicles: vehicles,
                metadata: getMetadata()
            };
            
            try {
                console.log('Submitting to Google Apps Script...');
                
                // Send to Google Apps Script
                const response = await fetch(SCRIPT_URL, {
                    method: 'POST',
                    mode: 'no-cors', // Important for Google Apps Script
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(data)
                });
                
                console.log('Request sent, waiting for confirmation...');
                
                // Since mode is 'no-cors', we won't get a readable response
                // But the request will still be sent to the script
                // Show success message after a brief delay to ensure request is sent
                setTimeout(() => {
                    console.log('Showing success modal...');
                    
                    // Generate local confirmation number (script will generate its own)
                    const confirmationNumber = `AUTO-${new Date().getFullYear()}${String(new Date().getMonth() + 1).padStart(2, '0')}${String(new Date().getDate()).padStart(2, '0')}-${Math.floor(Math.random() * 10000).toString().padStart(4, '0')}`;
                    
                    // Update confirmation number in modal
                    const modalConfirmationEl = document.getElementById('modal-confirmation-number');
                    if (modalConfirmationEl) {
                        modalConfirmationEl.textContent = confirmationNumber;
                    }
                    
                    // Update customer email in modal
                    const customerEmailEl = document.getElementById('customer-email');
                    if (customerEmailEl) {
                        customerEmailEl.textContent = data.email;
                    }
                    
                    // Hide loading overlay first
                    loadingOverlay.classList.remove('active');
                    loadingOverlay.style.display = 'none';
                    
                    // Show success modal popup with force display
                    const successModal = document.getElementById('successModal');
                    if (successModal) {
                        console.log('Success modal found, displaying...');
                        successModal.style.display = 'flex';
                        successModal.classList.add('active');
                        // Force a reflow to ensure animation plays
                        successModal.offsetHeight;
                    } else {
                        console.error('Success modal not found!');
                        // Fallback alert
                        alert(`Thank you for reaching out! We're now shopping your coverage with all our carriers.\n\nYour confirmation number: ${confirmationNumber}\n\nWe'll contact you within 24 hours with competitive quotes.`);
                    }
                    
                    // Store confirmation in sessionStorage for reference
                    sessionStorage.setItem('lastQuoteConfirmation', confirmationNumber);
                    
                    // Reset submit button
                    submitBtn.disabled = false;
                    submitBtn.innerHTML = 'Submit Quote Request<i class="fas fa-paper-plane ml-2"></i>';
                }, 1500);
                
            } catch (error) {
                console.error('Submission error:', error);
                
                // Hide loading overlay
                loadingOverlay.classList.remove('active');
                
                // Reset submit button
                submitBtn.disabled = false;
                submitBtn.innerHTML = 'Submit Quote Request<i class="fas fa-paper-plane ml-2"></i>';
                
                // Show error but offer mailto fallback
                const confirmFallback = confirm('There was an issue submitting your quote online. Would you like to send it via email instead?');
                
                if (confirmFallback) {
                    // Prepare mailto fallback
                    const subject = encodeURIComponent('Auto Insurance Quote Request');
                    const body = encodeURIComponent(generateEmailBody(data));
                    const mailtoLink = `mailto:Save@BillLayneInsurance.com?subject=${subject}&body=${body}`;
                    
                    window.location.href = mailtoLink;
                }
            }
        });
        
        // Generate email body for fallback
        function generateEmailBody(data) {
            let body = `New Auto Insurance Quote Request\n\n`;
            body += `CONTACT INFORMATION:\n`;
            body += `Name: ${data.firstname} ${data.lastname}\n`;
            body += `Email: ${data.email}\n`;
            body += `Phone: ${data.phone}\n`;
            body += `Preferred Contact: ${data.contact_method}\n\n`;
            
            body += `CURRENT INSURANCE:\n`;
            body += `Has Insurance: ${data.current_insurance}\n`;
            body += `Current Carrier: ${data.current_carrier || 'N/A'}\n`;
            body += `Expiration: ${data.coverage_expiration || 'N/A'}\n\n`;
            
            body += `DRIVERS:\n`;
            data.drivers.forEach((driver, index) => {
                body += `Driver ${index + 1}: ${driver.name}\n`;
                body += `  DOB: ${driver.dob || 'N/A'}\n`;
                body += `  Gender: ${driver.gender || 'N/A'}\n`;
                body += `  Marital Status: ${driver.marital || 'N/A'}\n`;
            });
            
            body += `\nVEHICLES:\n`;
            data.vehicles.forEach((vehicle, index) => {
                body += `Vehicle ${index + 1}: ${vehicle.year} ${vehicle.make} ${vehicle.model}\n`;
                body += `  VIN: ${vehicle.vin || 'N/A'}\n`;
            });
            
            body += `\nCOVERAGE PREFERENCES:\n`;
            body += `Liability Limits: ${data.liability_limits || 'Not specified'}\n`;
            body += `Collision: ${data.collision ? 'Yes' : 'No'}\n`;
            body += `Comprehensive: ${data.comprehensive ? 'Yes' : 'No'}\n`;
            body += `Uninsured Motorist: ${data.uninsured_motorist ? 'Yes' : 'No'}\n`;
            body += `Medical Payments: ${data.medical_payments ? 'Yes' : 'No'}\n`;
            body += `Rental Reimbursement: ${data.rental_reimbursement ? 'Yes' : 'No'}\n`;
            body += `Roadside Assistance: ${data.roadside_assistance ? 'Yes' : 'No'}\n\n`;
            
            body += `ADDITIONAL INFORMATION:\n`;
            body += `Previous Claims: ${data.previous_claims}\n`;
            body += `Violations: ${data.violations}\n`;
            if (data.additional_notes) {
                body += `Notes: ${data.additional_notes}\n`;
            }
            
            return body;
        }
    </script>
</body>
</html>